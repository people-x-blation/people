<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>피플</title>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link rel="stylesheet" href="/aos/aos.css" />
    <link rel="apple-touch-icon" sizes="57x57" href="/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="title" content="피플">
    <meta name="description" content="세상을 구하는 붉은 인연, 전국민 헌혈 참여 플랫폼 피플입니다">
    <meta name="keywords" content="헌혈,헌혈자모집,수혈,지정헌혈">
    <meta name="robots" content="index, nofollow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="Korean">
    <meta name="author" content="피플">
    <script src="/javascript/base.js"></script>
</head>

<body>
    <!-- Loading -->
    <div id="loading">
        <img src="/images/logo.svg">
        <span>로딩중 입니다...</span>
    </div>

    <!-- FLOATING -->
    <div class="floating_btn">
        <a href="/notice"><img src="/images/class-whiteboard.svg" alt="공지사항"/><span>공지사항</span></a>
    </div>

    <!-- NAVBAR -->
    <nav>
        <ul>
            <li><a href="/"><img id="nav_landing" src="/images/landing.svg" alt="홈" /></a><span
                    id="nav_home_span">홈</span>
            </li>
            <li><a href="/board"><img id="nav_home" src="/images/home.svg" alt="홈" /></a><span id="nav_home_span">요청
                    리스트</span></li>
            <% if(!user) { %>
            <li><a href="/auth/kakao"><img id="nav_login" src="/images/login.svg" alt="로그인" /></a><span
                    id="nav_login_span">로그인</span></li>
            <% } %>
            <% if(user) { %>
            <li><a href="/board/write"><img id="nav_write" src="/images/write.svg" alt="글 작성" /></a><span
                    id="nav_write_span">요청</span></li>
            <% } %>
            <li><a href="/board/search"><img id="nav_search" src="/images/search.svg" alt="검색" /></a><span
                id="nav_search_span">검색</span></li>
            <% if(user) { %>
            <li><a href="/user/mypage"><img id="nav_mypage" src="/images/mypage.svg" alt="마이페이지" /></a><span
                    id="nav_mypage_span">마이페이지</span></li>
            <% } %>
        </ul>
    </nav>

    <section class="list_location_selection">
        <ul data-aos="fade-down">
            <li id="location_toggle">지역 보기 ▼</li>
            <li class="location_item"><a href="/board/1" %>>서울</a></li>
            <li class="location_item"><a href="/board/2" %>>부산</a></li>
            <li class="location_item"><a href="/board/3" %>>대구</a></li>
            <li class="location_item"><a href="/board/4" %>>인천</a></li>
            <li class="location_item"><a href="/board/5" %>>대전</a></li>
            <li class="location_item"><a href="/board/6" %>>광주</a></li>
            <li class="location_item"><a href="/board/7" %>>울산</a></li>
            <li class="location_item"><a href="/board/8" %>>세종</a></li>
            <li class="location_item"><a href="/board/9" %>>강원도</a></li>
            <li class="location_item"><a href="/board/10" %>>경기도</a></li>
            <li class="location_item"><a href="/board/11" %>>충청남도</a></li>
            <li class="location_item"><a href="/board/12" %>>전라북도</a></li>
            <li class="location_item"><a href="/board/13" %>>전라남도</a></li>
            <li class="location_item"><a href="/board/14" %>>경상북도</a></li>
            <li class="location_item"><a href="/board/15" %>>경상남도</a></li>
            <li class="location_item"><a href="/board/16" %>>제주도</a></li>
        </ul>
    </section>


    <h2 id="list_header_location"><%=(location == 0) ? '전체보기' : location %></h2>
    <% if(!user) { %>
    <div data-aos="fade-left" id="list_header_pleaseLogin">
        <h4>로그인 되지 않았습니다.</h4>
        <p>로그인을 해야 헌혈 참가의사를 밝힐 수 있습니다.<br/>로그인 해주시길 바랍니다.</p>
    </div>
    <% } %>
    <div id="wrapper">
        <% if(list.length == 0) { %>
        <span data-aos="fade-left" id="list_no_result">사연글이 존재하지 않습니다.</span>
        <img data-aos="fade-left" id="list_no_result_img" src="/images/empty.svg" alt="결과 없음" />
        <% } else { %>
        <% for(let item=0 ; item<list.length; item++) { %>
        <div data-aos="fade-left" data-aos-duration="1300" class="list_container" style=" cursor: pointer;"  onclick="location.href='/board/read/<%=list[item].boardnum%>';">
            <div class="highlight_wrapper" style="background-color: <%=bloodColorTable[list[item].blood]%>">
                <span id="highlight_location"><%=locationTable[list[item].location]%></span>
                <span id="highlight_blood"><%=(list[item].blood === 'none') ? '미지정' : list[item].blood%></span>
                <span id="highlight_type"><%=(list[item].type === null) ? '' : typeTable[list[item].type]%></span>
            </div>
            <div class="content_wrapper">
                <hidden id='boardnum' value=<%=list[item].boardnum%></hidden> 
                <span id="list_user_id"><%=list[item].nickname%></span>
                <% if(list[item].show_flag == '1') { %>
                <h2 id="list_title">
                    <a href="/board/read/<%=list[item].boardnum%>"><%=list[item].title%></a>
                </h2>
                <span id="list_like_likecount">지원자 수 : <%=list[item].num_part%></span>
                <% } else { %>
                <h2 id="list_title">
                    <%=list[item].title%>
                </h2>
                <span id="list_like_likecount" style="color: red">헌혈자가 모두 모집되었습니다. 감사합니다.</span>
                <% } %>
            </div>
        </div>
        <%} }%>
    </div>




    <script src="/jquery/jquery.min.js"></script>
    <script src="/aos/aos.js"></script>
    <script>
        $(document).ready(function () {
            const bloodColorTable = {
                'none': '#acada8',
                'RH+ A': '#e56662',
                'RH+A': '#e56662',
                'RH+ B': '#e0514e',
                'RH+B': '#e0514e',
                'RH+ O': '#da3d36',
                'RH+O': '#da3d36',
                'RH+ AB': '#ed6b68',
                'RH+AB': '#ed6b68',
                'RH- A': '#36bc9b',
                'RH-A': '#36bc9b',
                'RH- B': '#36bc9b',
                'RH-B': '#36bc9b',
                'RH- AB': '#36bc9b',
                'RH-AB': '#36bc9b',
                'RH- O': '#36bc9b',
                'RH-O': '#36bc9b',
            };
            AOS.init();
            let renderList = function (vo) {
                const html = '<div data-aos="fade-left" data-aos-duration="1300" class="list_container" style=" cursor: pointer;"  onclick="location.href=\'./read/' + vo.boardnum + '\'";>' +
                    `<div class="highlight_wrapper" style="background-color:${bloodColorTable[vo.blood]}">` +
                    '<span id="highlight_location"><%=locationTable[' + vo.location + ']%></span>' +
                    '<span id="highlight_blood">' + ((vo.blood == 'none') ? '미지정' : vo.blood) + '</span>' +
                    '</div>' +
                    '<div class="content_wrapper">' +
                    '<hidden id="boardnum" value=' + vo.boardnum + '</hidden>' +
                    '<span id="list_user_id">' + vo.nickname + '</span>' +
                    '<h2 id="list_title">' +
                    '<a href="./read/' + vo.boardnum + '">' + vo.title + '</a>' +
                    '</h2>' +
                    '<span id="list_like_likecount">지원 + 응원 : ' + vo.like_count + '</span>' +
                    '</div>' +
                    '</div>';
                $("#wrapper").append(html);
            }
            let key = true;
            let page = 2;
            let isEnd = false;

            $(function () {
                $(window).scroll(function () {
                    let $window = $(this);
                    let scrollTop = $window.scrollTop();
                    let windowHeight = $window.height();
                    let documentHeight = $(document).height();

                    if (scrollTop + windowHeight + 500 >= documentHeight && key) {
                        key = false;
                        fetchList();
                        page++;


                    }
                })
            })

            let fetchList = function () {

                if (isEnd == true) {
                    return;
                }


                $.ajax({
                    url: "/board/" + $('#list_location').text() + "?page=" + page,
                    type: "GET",
                    dataType: "json",
                    success: function (result) {
                        let length = result.length;
                        if (length < 10) {
                            isEnd = true;
                        }

                        key = true;

                        $.each(result, function (index, vo) {
                            renderList(vo);
                        })
                    },
                    error: function (err) {
                        console.log(err)
                    }
                });
            }
        })

    </script>
</body>

</html>