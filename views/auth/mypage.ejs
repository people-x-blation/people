<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>피플</title>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <script src="/javascript/base.js"></script>
</head>

<body>
    <!-- Loading -->
    <div id="loading">
        <img src="/images/logo.svg">
        <span>로딩중 입니다...</span>
    </div>

    <!-- NAVBAR -->
    <nav>
        <ul>
            <li><a href="/board"><img id="nav_home" src="/images/home.svg" alt="홈" /></a><span id="nav_home_span">홈</span></li>
            <li><a href="/board/search"><img id="nav_search" src="/images/search.svg" alt="검색" /></a><span id="nav_search_span">검색</span></li>
            <li><a href="/board/write"><img id="nav_write" src="/images/write.svg" alt="글 작성" /></a><span id="nav_write_span">요청글 작성</span></li>
            <li><a href="/auth/login"><img id="nav_login" src="/images/login.svg" alt="로그인" /></a><span id="nav_login_span">로그인</span></li>
            <li><a href="/auth/kakao/logout"><img id="nav_logout" src="/images/logout.svg" alt="로그아웃" /></a><span id="nav_logout_span">로그아웃</span></li>
            <li><a href="/auth/kakao?requestUrl=/board"><img id="nav_signup" src="/images/signup.svg" alt="회원가입" /></a><span id="nav_signup_span">회원가입</span></li>
            <li><a href="/auth/mypage"><img id="nav_mypage" src="/images/mypage.svg" alt="마이페이지" /></a><span id="nav_mypage_span">마이페이지</span></li>
        </ul>
    </nav>

    <!-- USER PAGE -->
    <div data-aos="fade-left" id="mypage_info" class="container">
        <h1>마이페이지</h1>
        <div id="mypage_row_wrapper">
            <div id="profile_wrap">
                <img id="profile_pic" src="<%=kakao_info.properties.profile_image%>" />
                <span id="mypage_nickname"><%=member_db.nickname%></span>
                <span id="mypage_blood"><%=member_db.blood%> 형</span>
            </div>
            <div id="mypage_info_wrap">
                
                <table>
                    <tr>
                        <th>전화번호</th>
                        <td><%=member_db.phone%></td>
                    </tr>
                    <tr>
                        <th>이메일</th>
                        <td><%=member_db.email%></td>
                    </tr>                    
                    <tr>
                        <th>게시 요청 수</th>
                        <td><%=board_db.length%></td>
                    </tr>
                </table>
                <button onclick="location.href='/auth/logout'">로그아웃</button>
                <form action="">
                    <button>회원 탈퇴</button>
                </form>
                
            </div>
        </div>
    </div>
    
    <h2 style="text-align: center;">작성 요청 목록</h2>
    <% for(let item in board_db) { %>
    <div data-aos="fade-left" class="container mypage_request_list">
        <table>
            <tr>
                <th>요청번호</th>
                <td><%=board_db[item].boardnum%></td>
            </tr>
            <tr>
                <th>제목</th>
                <td><%=board_db[item].title%></td>
            </tr>
            <tr>
                <th>게시글 노출 여부</th>
                <td style="color: <%=(board_db[item].show_flag == '1') ? 'black':'red'%>"><%=(board_db[item].show_flag == '1') ? '노출 중':'게시 종료(또는 게시 거부)'%></td>
            </tr>
            <tr>
                <th>내용</th>
                <td><%=board_db[item].contents%></td>
            </tr>
            <tr>
                <th>최초 작성일자</th>
                <td><%=board_db[item].create_at.toLocaleString()%></td>
            </tr>
        </table>
        <% if(board_db[item].show_flag == '1') { %>
        <form class="mypage_request_off_form" action="../auth/request_off" method="POST">
            <input type="hidden" name="request_off" value="<%=board_db[item].boardnum%>" />
            <button class="mypage_request_off_btn">요청 내리기</button>
        </form>
        <% } %>
    </div>
    <% } %>
    <script src="/jquery/jquery.min.js"></script>
    <script src="/aos/aos.js"></script>
    <script>
    $( document ).ready( function() {
        var mypageRequestOffForm = $('.mypage_request_off_form');
        var mypageRequestOffBtn = $('.mypage_request_off_btn');
        AOS.init();
        mypageRequestOffBtn.forEach(function(el){
            el.click(function(e){
                e.preventDefault();
                if(confirm("요청은 한번 내리면 다시 재개할 수 없습니다. 내리시겠습니까?")){
                    mypageRequestOffForm.submit(); 
                }
            })  
        });
    });
    </script>
</body>

</html>